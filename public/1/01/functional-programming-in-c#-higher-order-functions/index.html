<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Functional Programming in C# - Higher-Order Functions | The Wandering Glitch</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Functional Programming - Is it worth your time? Functional Programming in C# - Higher-Order Functions This is the second in a series on the basics of functional programming using C#. My topic today is one I touched on last time, when I described the rights and privileges of a function as a first class citizen. I&rsquo;m going to explore Higher-Order Functions this time. Higher-Order Functions are functions that themselves take or return functions.">
    <meta name="generator" content="Hugo 0.108.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="Functional Programming in C# - Higher-Order Functions" />
<meta property="og:description" content="Functional Programming - Is it worth your time? Functional Programming in C# - Higher-Order Functions This is the second in a series on the basics of functional programming using C#. My topic today is one I touched on last time, when I described the rights and privileges of a function as a first class citizen. I&rsquo;m going to explore Higher-Order Functions this time. Higher-Order Functions are functions that themselves take or return functions." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://industrialinference.com/1/01/functional-programming-in-c#-higher-order-functions/" /><meta property="article:section" content="posts" />


<meta itemprop="name" content="Functional Programming in C# - Higher-Order Functions">
<meta itemprop="description" content="Functional Programming - Is it worth your time? Functional Programming in C# - Higher-Order Functions This is the second in a series on the basics of functional programming using C#. My topic today is one I touched on last time, when I described the rights and privileges of a function as a first class citizen. I&rsquo;m going to explore Higher-Order Functions this time. Higher-Order Functions are functions that themselves take or return functions.">

<meta itemprop="wordCount" content="1630">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Functional Programming in C# - Higher-Order Functions"/>
<meta name="twitter:description" content="Functional Programming - Is it worth your time? Functional Programming in C# - Higher-Order Functions This is the second in a series on the basics of functional programming using C#. My topic today is one I touched on last time, when I described the rights and privileges of a function as a first class citizen. I&rsquo;m going to explore Higher-Order Functions this time. Higher-Order Functions are functions that themselves take or return functions."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        The Wandering Glitch
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
    
    <a href="https://twitter.com/aabs" target="_blank" rel="noopener" class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://github.com/aabs" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://techhub.social/@aabs" target="_blank" rel="me noopener" class="mastadon ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="mastadon link" aria-label="follow on mastadon——Opens in a new window">
      
        mastadon
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
      
      <a href="https://twitter.com/share?url=https://industrialinference.com/1/01/functional-programming-in-c#-higher-order-functions/&amp;text=Functional%20Programming%20in%20C#%20-%20Higher-Order%20Functions" class="ananke-social-link twitter no-underline" aria-label="share on Twitter">
        
        <span class="icon"> <svg style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>
</span>
        
      </a>
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Functional Programming in C# - Higher-Order Functions</h1>
      
      <p class="tracked">
        By <strong>aabs</strong>
      </p>
      
      
      

      
      
        <span class="f6 mv4 dib tracked"> - 8 minutes read </span>
        <span class="f6 mv4 dib tracked"> - 1630 words </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><ol>
<li><a href="http://aabs.wordpress.com/2008/04/09/functional-programming-is-it-worth-your-time/" title="Functional Programming - Is it worth your time?">Functional Programming - Is it worth your time?</a></li>
<li><a href="http://aabs.wordpress.com/2008/04/16/unctional-programming-in-csharp-higher-order-functions/">Functional Programming in C# - Higher-Order Functions</a></li>
</ol>
<p>This is the second in a series on the basics of functional programming using C#. My topic today is one I touched on last time, when I described the rights and privileges of a function as a first class citizen. I&rsquo;m going to explore Higher-Order Functions this time. Higher-Order Functions are functions that themselves take or return functions. Meta-functions, if you like.</p>
<p>As I explained last time, my programming heritage is firmly in the object-oriented camp. For me, the construction, composition and manipulation of composite data structures is second nature. A higher-order function is the equivalent from the functional paradigm. You can compose, order and recurse a tree of functions in just the same way as you manipulate your data. I&rsquo;m going to describe a few of the techniques for doing that using an example of pretty printing some source code for display on a web site.</p>
<p>I&rsquo;ve just finished a little project at <a href="http://www.readify.net">Readify</a> allowing us to conduct code reviews whenever an interesting code change gets checked into our TFS servers. A key feature of that is pretty-printing the source before rendering it. Obviously, if you&rsquo;re displaying XHTML on an XHTML page, your browser will get confused pretty quickly unless you take steps to HTML-escape all the XHTML entities that might corrupt the display. The examples I&rsquo;ll show will highlight the difference between the procedural and functional approaches.</p>
<p>This example shows a fairly typical implementation that takes a file that&rsquo;s been split into lines:</p>
<p>[public static string]{style=&ldquo;color:#0000ff;&rdquo;}[] RenderLinesProcedural([string]{style=&ldquo;color:#0000ff;&rdquo;}[] lines)
{
    [for ]{style=&ldquo;color:#0000ff;&rdquo;}([int ]{style=&ldquo;color:#0000ff;&quot;}i = 0; i &lt; lines.Count(); i++)
    {
      lines[i] = EscapeLine(lines[i]);
    }
    [return ]{style=&ldquo;color:#0000ff;&quot;}lines;
}</p>
<p>[public static string ]{style=&ldquo;color:#0000ff;&quot;}EscapeLine([string ]{style=&ldquo;color:#0000ff;&quot;}line)
{
  [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine([&ldquo;converting &quot; ]{style=&ldquo;color:#a31515;&rdquo;}+ line);
  [return ]{style=&ldquo;color:#0000ff;&quot;}line.Replace([&rdquo; &ldquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&rdquo;  &ldquo;]{style=&ldquo;color:#a31515;&rdquo;})
      .Replace([&rdquo;\t&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&rdquo;  &ldquo;]{style=&ldquo;color:#a31515;&rdquo;})
      .Replace([&rdquo;&lt;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&rdquo;&lt;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;})
      .Replace([&quot;&gt;&quot;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&gt;&quot;]{style=&ldquo;color:#a31515;&rdquo;});
}</p>
<p>There&rsquo;s a few things worth noticing here. In C#, strings are immutable. That means that whenever you think that you are changing a string, you&rsquo;re not. In the background, the CLR is constructing a modified copy of the string for you. The Array of strings on the other hand is not immutable, therefore a legitimate procedural approach is to make an in-place modification of the original collection and pass that back.  The EscapeLine method repeatedly makes modified copies of the line string passing back the last copy.</p>
<p>Despite C# not being a pure functional programming language[<a href="http://en.wikipedia.org/wiki/Functional_programming#Pure_functions">1</a>], it&rsquo;s still doing a lot of copying in this little example. My early impression was that pure functional programming (where all values are immutable) would be inefficient because of all the copying goign on. Yet here is a common-or-garden object oriented language that uses exactly the same approach to managing data, and we all use it without a qualm. In case you didn&rsquo;t know, StringBuilder is what you should be using if you need to make in-place modifications to strings.</p>
<p>Let&rsquo;s run the procedural code and record what happens:</p>
<p>[private static void ]{style=&ldquo;color:#0000ff;&quot;}TestProcedural()
{
   [string]{style=&ldquo;color:#0000ff;&rdquo;}[] originalLines = [new string]{style=&ldquo;color:#0000ff;&rdquo;}[] { [&rdquo;&lt;head&gt;&quot;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&lt;/head&gt;&quot; ]{style=&ldquo;color:#a31515;&rdquo;}};
   [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine([&ldquo;Converting the lines&rdquo;]{style=&ldquo;color:#a31515;&rdquo;});
   [IEnumerable]{style=&ldquo;color:#2b91af;&rdquo;}&lt;[string]{style=&ldquo;color:#0000ff;&rdquo;}&gt; convertedStrings = RenderLinesProcedural(originalLines);
   [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine([&ldquo;Converted the lines?&rdquo;]{style=&ldquo;color:#a31515;&rdquo;});</p>
<p>[   foreach ]{style=&ldquo;color:#0000ff;&rdquo;}([string ]{style=&ldquo;color:#0000ff;&quot;}s [in ]{style=&ldquo;color:#0000ff;&quot;}convertedStrings)
    {
    [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine(s);
    }
}</p>
<p>Here&rsquo;s the output:</p>
<blockquote>
<p><a href="%7Bstatic%7D2008/04/clip-image001.png"><img src="%7Bstatic%7D2008/04/clip-image001-thumb.png" alt="clip\_image001">{width=&ldquo;165&rdquo; height=&ldquo;118&rdquo;}</a></p>
</blockquote>
<p>As you can see, the lines all got converted before we even got to the &ldquo;converted the lines?&rdquo; statement. That&rsquo;s called &lsquo;Eager Evaluation&rsquo;, and it certainly has its place in some applications. Now lets use Higher-Order Functions:</p>
<p>[public static ]{style=&ldquo;color:#0000ff;&rdquo;}[IEnumerable]{style=&ldquo;color:#2b91af;&rdquo;}&lt;[string]{style=&ldquo;color:#0000ff;&rdquo;}&gt; RenderLinesFunctional([IEnumerable]{style=&ldquo;color:#2b91af;&rdquo;}&lt;[string]{style=&ldquo;color:#0000ff;&rdquo;}&gt; lines)
{
    [return ]{style=&ldquo;color:#0000ff;&quot;}lines.Map(s =&gt; EscapeString(s));
}</p>
<p>[static ]{style=&ldquo;color:#0000ff;&rdquo;}[IEnumerable]{style=&ldquo;color:#2b91af;&rdquo;}&lt;R&gt; Map&lt;T, R&gt;([this ]{style=&ldquo;color:#0000ff;&rdquo;}[IEnumerable]{style=&ldquo;color:#2b91af;&rdquo;}&lt;T&gt; seq, [Func]{style=&ldquo;color:#2b91af;&rdquo;}&lt;T, R&gt; f)
{
   [foreach ]{style=&ldquo;color:#0000ff;&rdquo;}([var ]{style=&ldquo;color:#0000ff;&quot;}t [in ]{style=&ldquo;color:#0000ff;&quot;}seq)
     [yield return ]{style=&ldquo;color:#0000ff;&quot;}f(t);
}</p>
<p>[static string ]{style=&ldquo;color:#0000ff;&quot;}EscapeString([string ]{style=&ldquo;color:#0000ff;&quot;}s)
{
   [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine([&ldquo;converting &quot; ]{style=&ldquo;color:#a31515;&rdquo;}+ s);
   [return ]{style=&ldquo;color:#0000ff;&quot;}s.Replace([&rdquo;  &ldquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;  &rdquo;]{style=&ldquo;color:#a31515;&rdquo;})
     .Replace([&rdquo;\t&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;  &rdquo;]{style=&ldquo;color:#a31515;&rdquo;})
     .Replace([&rdquo;&lt;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&lt;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;})
     .Replace([&rdquo;&gt;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&gt;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;});
}</p>
<p>[private static void ]{style=&ldquo;color:#0000ff;&quot;}TestFunctional()
{
   [string]{style=&ldquo;color:#0000ff;&rdquo;}[] originalLines = [new string]{style=&ldquo;color:#0000ff;&rdquo;}[] { [&rdquo;&lt;head&gt;&quot;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&lt;/head&gt;&quot; ]{style=&ldquo;color:#a31515;&rdquo;}};
   [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine([&ldquo;Converting the lines&rdquo;]{style=&ldquo;color:#a31515;&rdquo;});
   [IEnumerable]{style=&ldquo;color:#2b91af;&rdquo;}&lt;[string]{style=&ldquo;color:#0000ff;&rdquo;}&gt; convertedStrings = RenderLinesFunctional(originalLines);
   [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine([&ldquo;Converted the lines?&rdquo;]{style=&ldquo;color:#a31515;&rdquo;});</p>
<p>[   foreach ]{style=&ldquo;color:#0000ff;&rdquo;}([string ]{style=&ldquo;color:#0000ff;&quot;}s [in ]{style=&ldquo;color:#0000ff;&quot;}convertedStrings)
    {
    [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine(s);
    }
}</p>
<p>This time the output looks different:</p>
<blockquote>
<p><a href="%7Bstatic%7D2008/04/clip-image0015.png"><img src="%7Bstatic%7D2008/04/clip-image0015-thumb.png" alt="clip\_image001\[5\]">{width=&ldquo;157&rdquo; height=&ldquo;113&rdquo;}</a></p>
</blockquote>
<p>At the time that the &ldquo;Converted the Lines?&rdquo; statement gets run, the lines have not yet been converted. This is called &lsquo;Lazy Evaluation[<a href="http://en.wikipedia.org/wiki/Lazy_evaluation">2</a>]&rsquo;, and it&rsquo;s a powerful weapon in the functional armamentarium. For the simple array that I&rsquo;m showing here, the technique looks like overkill but imagine that you were using a paged control on a big TFS installation like Readify&rsquo;s <a href="http://www.tfsnow.com/Tour/WhatIsTFS.aspx">TFSNow</a>. You might have countless code reviews going on. If you rendered every line of code in all the files being viewed, you would waste both processor and bandwidth resources needlessly.</p>
<p>So what did I do to change the way this program worked so fundamentally? Well the main thing was to opt to use the IEnumerable interface, which then gave me the scope to provide an alternative implementation to representing the collection. in the procedural example, the return type was a string array, so I was bound to create and populate the array before returning from the function. That&rsquo;s a point worth highlighting: <em><strong>Use iterators as return types where possible - they allow you to mix <a href="http://en.wikipedia.org/wiki/Programming_paradigms">paradigms</a></strong></em>. Converting to IEnumerables is not enough. I could change the signature of TestProcedural to use iterators, but it would still have used Eager Evaluation.</p>
<p>The next thing I did was use the Map function to return a functional iterator rather than a concrete object graph as was done in the procedural example. I created Map here to demonstrate that there was no funny LINQ business going on in the background. In most cases I would use the [Enumerable.Select()]{style=&ldquo;font-size:x-small;font-family:Courier New;&rdquo;} extension method from LINQ to do the same thing. Map is a function that is common in functional programming, it allows the lazy transformation of a stream or collection into something more useful. Map is the crux of the transformation - it allows you to insert a function into the simple process of iterating a collection.</p>
<p>Map is a Higher-Order Function, it accepts a function as a parameter and applies it to a collection on demand. Eventually you will need to deal with raw data - such as when you bind it to a GridView. Till that point you can hold off on committing resources that may not get used. Map is not the only HOF that we can use in this scenario. We&rsquo;re repeatedly calling String.Replace in our functions. Perhaps we can generalise the idea of repeatedly calling a function with different parameters.</p>
<p>[Func]{style=&ldquo;color:#2b91af;&rdquo;}&lt;T, T&gt; On&lt;T&gt;([this ]{style=&ldquo;color:#0000ff;&rdquo;}[Func]{style=&ldquo;color:#2b91af;&rdquo;}&lt;T, T&gt; f, [Func]{style=&ldquo;color:#2b91af;&rdquo;}&lt;T, T&gt; g)
{
    [return ]{style=&ldquo;color:#0000ff;&quot;}t =&gt; g(f(t));
}</p>
<p>This method encapsulates the idea of composing functions. I&rsquo;m creating a function that returns the result of applying the inner function to an input value of type T, and then applying the outer function to the result. In normal mathematical notation this would be represented by the notation &ldquo;g [o]{style=&ldquo;font-size:xx-small;&rdquo;} f&rdquo;, meaning <em>g</em> applied to <em>f</em>. Composition is a key way of building up more complex functions. It&rsquo;s the linked list of the functional world - well it would be if the functional world were denied normal data structures, which it isn&rsquo;t. :P</p>
<p>Notice that I&rsquo;m using an extension method here, to make it nicer to deal with functions in your code. The next example is just a test method to introduce the new technique.</p>
<p>[private static void ]{style=&ldquo;color:#0000ff;&quot;}TestComposition()
{
    [var ]{style=&ldquo;color:#0000ff;&quot;}seq1 = [new int]{style=&ldquo;color:#0000ff;&rdquo;}[] { 1, 3, 5, 7, 11, 13, 19 };
    [var ]{style=&ldquo;color:#0000ff;&quot;}g = (([Func]{style=&ldquo;color:#2b91af;&rdquo;}&lt;[int]{style=&ldquo;color:#0000ff;&rdquo;}, [int]{style=&ldquo;color:#0000ff;&rdquo;}&gt;)(a =&gt; a + 2)).On(b =&gt; b * b).On(c =&gt; c + 1);
    [foreach ]{style=&ldquo;color:#0000ff;&rdquo;}([var ]{style=&ldquo;color:#0000ff;&quot;}i [in ]{style=&ldquo;color:#0000ff;&quot;}seq1.Map(g))
    {
      [Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine(i);
    }
}</p>
<p>TestComposition uses the &lsquo;On&rsquo; extension to compose functions into more complex functions. The actual function is not really that important, the point is that I packaged up a group of functions to be applied in order to an input value and then stored that function for later use. You might think that that&rsquo;s no big deal, since the function could be achieved by even the most trivial procedure. But this is dynamically composing functions - think about what you could do with dynamically composable functions that don&rsquo;t require complex control logic to make them work properly. Our next example shows how this can be applied to escaping strings for display on a web page.</p>
<p>[void ]{style=&ldquo;color:#0000ff;&quot;}TestComposition2()
{
   [var ]{style=&ldquo;color:#0000ff;&quot;}strTest = [@&rdquo;&lt;html&gt;&lt;body&gt;hello world&lt;/body&gt;&lt;/html&gt;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;};
   [string]{style=&ldquo;color:#0000ff;&rdquo;}[][] replacements = [new]{style=&ldquo;color:#0000ff;&rdquo;}[]
     {
       [new]{style=&ldquo;color:#0000ff;&rdquo;}[]{[&rdquo;&amp;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&amp;&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}},
       [new]{style=&ldquo;color:#0000ff;&rdquo;}[]{[&rdquo;  &ldquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;  &rdquo;]{style=&ldquo;color:#a31515;&rdquo;}},
       [new]{style=&ldquo;color:#0000ff;&rdquo;}[]{[&rdquo;\t&rdquo;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;  &rdquo;]{style=&ldquo;color:#a31515;&rdquo;}},
       [new]{style=&ldquo;color:#0000ff;&rdquo;}[]{[&rdquo;&lt;&quot;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&lt;&quot;]{style=&ldquo;color:#a31515;&rdquo;}},
       [new]{style=&ldquo;color:#0000ff;&rdquo;}[]{[&quot;&gt;&quot;]{style=&ldquo;color:#a31515;&rdquo;}, [&quot;&gt;&quot;]{style=&ldquo;color:#a31515;&rdquo;}}
     };</p>
<p>[  Func]{style=&ldquo;color:#2b91af;&rdquo;}&lt;[string]{style=&ldquo;color:#0000ff;&rdquo;}, [string]{style=&ldquo;color:#0000ff;&rdquo;}&gt; f = x =&gt; x;
  [foreach ]{style=&ldquo;color:#0000ff;&rdquo;}([string]{style=&ldquo;color:#0000ff;&rdquo;}[] strings [in ]{style=&ldquo;color:#0000ff;&quot;}replacements)
  {
     [var ]{style=&ldquo;color:#0000ff;&quot;}s0 = strings[0];
     [var ]{style=&ldquo;color:#0000ff;&quot;}s1 = strings[1];
     f = f.On(s =&gt; s.Replace(s0, s1));
  }</p>
<p>[  Debug]{style=&ldquo;color:#2b91af;&rdquo;}.WriteLine(f(strTest));
}</p>
<p>This procedure is again doing something quite significant - it&rsquo;s taking a data structure and using that to guide the construction of a function that performs some data-driven processing on other data. Imagine that you took this from config data or a database somewhere. The function that gets composed is a fast, directly executable, encapsulated, interface free, type safe, dynamically generated unit of functionality. It has many of the benefits of the Gang Of Four Strategy Pattern[<a href="http://en.wikipedia.org/wiki/Strategy_pattern">3</a>].</p>
<p>The techniques I&rsquo;ve shown in this post demonstrate some of the power of the functional paradigm. I described how you can combine higher order functions with iterators to give a form of lazy evaluation. I also showed how you can compose functions to build up fast customised functions that can be data-driven. I&rsquo;ve also shown a simple implementation of the common Map method that allows a function to be applied to each of the elements of a collection. Lastly I provided a generic implementation of a function composition mechanism that allows you to build up complex functions within a domain.</p>
<p>Next time I&rsquo;ll introduce the concept of closure, which we&rsquo;ve seen here at work in the &lsquo;On&rsquo; composition function.</p>
<p>Some references:</p>
<p>1. Wikipedia: <a href="http://en.wikipedia.org/wiki/Functional_programming#Pure_functions" title="http://en.wikipedia.org/wiki/Functional_programming#Pure_functions">Pure Functions</a></p>
<p>2. Wikipedia: <a href="http://en.wikipedia.org/wiki/Lazy_evaluation" title="Lazy evaluation">Lazy Evaluation</a></p>
<p>3. Wikipedia: <a href="http://en.wikipedia.org/wiki/Strategy_pattern" title="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a></p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://industrialinference.com/" >
    &copy;  Andrew Matthews 2022 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://twitter.com/aabs" target="_blank" rel="noopener" class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" aria-label="follow on Twitter——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://github.com/aabs" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
    
    <a href="https://techhub.social/@aabs" target="_blank" rel="me noopener" class="mastadon ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="mastadon link" aria-label="follow on mastadon——Opens in a new window">
      
        mastadon
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
